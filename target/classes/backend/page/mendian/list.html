<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>店铺管理</title>
  <link rel="stylesheet" href="../../plugins/element-ui/index.css" />
  <link rel="stylesheet" href="../../styles/common.css" />
  <link rel="stylesheet" href="../../styles/page.css" />
  <style>
    .demo-table-expand {
      font-size: 0;
    }
    .demo-table-expand label {
      width: 90px;
      color: #99a9bf;
    }
    .demo-table-expand .el-form-item {
      margin-right: 0;
      margin-bottom: 0;
      width: 50%;
    }
    #app{
      padding-top: 25px;
      padding-left: 25px;
    }
    #app .notAdmin::after{
      border: 0 !important;
    }

    /* 添加的样式 */
    .status-green {
      color: green;
    }

    .status-red {
      color: red;
    }
  </style>
</head>
<body>
<div id="app">
  <div class="container">
    <!-- 表格 -->
    <el-table :data="tableData" :key="generateKey" style="width: 100%">
      <el-table-column type="expand">
        <template slot-scope="props">
          <el-form label-position="left" inline class="demo-table-expand">
            <!-- 门店信息展开部分 -->
            <el-form-item label="门店名称">
              <span>{{ props.row.name }}</span>
            </el-form-item>
            <el-form-item label="所属父门店">
              <span>{{ props.row.supermd }}</span>
            </el-form-item>
            <el-form-item label="总营业额">
              <span>{{ props.row.allmony }}$</span>
            </el-form-item>
            <el-form-item label="店铺 ID">
              <span>{{ props.row.id }}</span>
            </el-form-item>
            <el-form-item label="店铺地址">
              <span>{{ props.row.address }}</span>
            </el-form-item>
            <el-form-item label="所属负责人">
              <span>{{ props.row.supersonId}}</span>
            </el-form-item>
            <el-form-item label="创建人">
              <span>{{ props.row.createUser }}</span>
            </el-form-item>
            <el-form-item label="负责人电话">
              <span>{{ props.row.suphone }}</span>
            </el-form-item>
          </el-form>
        </template>
      </el-table-column>
      <el-table-column label="门店名称" prop="name"></el-table-column>
      <el-table-column label="图片" prop="image" align="center">
        <template slot-scope="{ row }">
          <el-image style="width: auto; height: 40px; border:none;cursor: pointer;"
                    :src="getImage(row.image)"
                    :preview-src-list="[ `/common/download?name=${row.image}` ]">
            <div slot="error" class="image-slot">
              <img src="./../../images/noImg.png" style="width: auto; height: 40px; border:none;">
            </div>
          </el-image>
        </template>
      </el-table-column>
      <el-table-column label="今日营业额" prop="todaymony"></el-table-column>
      <el-table-column label="状态" prop="status">
        <template slot-scope="{ row }">
          <span :class="row.stastus === 0 ? 'status-red' : 'status-green'">
            {{ row.stastus === 0 ? '关闭' : '营业中' }}
          </span>
        </template>
      </el-table-column>
      <el-table-column label="操作" prop="desc">
        <template slot-scope="{ row }">
          <el-button @click="statusHandle (row)" type="text" >
            {{ row.stastus === 1 ? '下线' : '上线' }}
          </el-button>
          <el-button
                  type="text"
                  @click="addMemberHandle(row.id)"
          >
            修改
          </el-button>
        </template>
      </el-table-column>
    </el-table>
  </div>
</div>
  <!-- 引入Vue.js和Element UI的脚本文件 -->
  <script src="../../plugins/vue/vue.js"></script>
  <script src="../../plugins/element-ui/index.js"></script>
  <script src="../../plugins/axios/axios.min.js"></script>
  <script src="../../js/request.js"></script>
  <script src="../../api/mendian.js"></script>
  <script>
    // 创建独立的Vue实例
    new Vue({
      el: '#app',
      data() {
        return {
          input: '',
          counts: 0,
          page: 1,
          pageSize: 10,
          // tableData : [],
          dishState : '',
          checkList: [],
          tableData: [],
        };
      },
      computed: {},
      //这个为生命周期函数，用于数据的初始化
      created() {
        this.init()
      },
      mounted() {
      },
      methods: {
     //   初始页面显示
        async init () {
          const params = {
            page: this.page,
            pageSize: this.pageSize,
            // name: this.input ? this.input : undefined
          }
          await getmendianPage(params).then(res => {
            if (String(res.code) === '1') {
              // alert(JSON.stringify(res.data.records))
             this.tableData = res.data.records || []
           //   this.tableData = res.data.records
              this.counts = res.data.total
            }
          }).catch(err => {
            this.$message.error('请求出错了：' + err)
          })
        },
        addMemberHandle (st) {
          if (st === 'add'){
            window.parent.menuHandle({
              id: '7',
              url: '/backend/page/member/add.html',
              name: '添加门店'
            },true)
          } else {
            window.parent.menuHandle({
              id: '7',
              url: '/backend/page/mendian/add.html?id='+st,
              name: '更改信息'
            },true)
          }
        },
        //显示图片
        getImage(image) {
          return `/common/download?name=${image}`;
        },

        //门店状态更改
        statusHandle (row) {
          this.id = row.id
          this.stastus = row.stastus
          this.$confirm('确认调整该账号的状态?', '提示', {
            'confirmButtonText': '确定',
            'cancelButtonText': '取消',
            'type': 'warning'
          }).then(() => {
            enableOrDisableEmployee({ 'id': this.id, 'stastus': !this.stastus ? 1 : 0 }).then(res => {
              console.log('enableOrDisableEmployee',res)
              if (String(res.code) === '1') {
                this.$message.success('状态更改成功！')
                this.init()
              }
            }).catch(err => {
              this.$message.error('请求出错了：' + err)
              this.init()
            })
          })
        }
        }
    });
  </script>
</body>
</html>
